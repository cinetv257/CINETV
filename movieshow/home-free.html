<!DOCTYPE html>
<html lang="rw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MovieShow - Tangira</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/png" href="logo.png">
</head>
<body>
    <!-- Barre de navigation supérieure -->
    <nav class="top-nav">
        <div class="nav-container">
            <div class="logo-center">
                <img src="logo.png" alt="MovieShow Logo" class="nav-logo">
            </div>
        </div>
    </nav>

    <!-- Contenu principal -->
    <main class="main-content">
        <!-- Section films en vedette -->
        <section class="featured-section">
            <div class="section-header">
                <h2><i class="fas fa-star"></i> Biraboneye</h2>
                <a href="movies.html" class="see-all">Reba byose <i class="fas fa-arrow-right"></i></a>
            </div>
            
            <div class="featured-carousel">
                <button class="carousel-btn prev-btn" id="prev-featured">
                    <i class="fas fa-chevron-left"></i>
                </button>
                
                <div class="featured-container" id="featured-container">
                    <!-- Films vedettes chargés depuis Firebase -->
                    <div class="loading-featured">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Irasa film ziza...</p>
                    </div>
                </div>
                
                <button class="carousel-btn next-btn" id="next-featured">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </section>

        <!-- Section toutes les vidéos -->
        <section class="all-videos">
            <div class="section-header">
                <h2><i class="fas fa-play-circle"></i> Filimu n'Imiseke</h2>
                <div class="sort-filter">
                    <select id="sort-by" class="filter-select">
                        <option value="newest">Byashyizeho vuba</option>
                        <option value="oldest">Byakozwe kera</option>
                        <option value="title">Zina</option>
                        <option value="popular">Bikunzwe</option>
                    </select>
                </div>
            </div>
            
            <div class="video-grid" id="video-grid">
                <!-- Vidéos chargées depuis Firebase -->
                <div class="loading-grid">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Irasa film n'imiseke...</p>
                </div>
            </div>
            
            <div class="load-more-container">
                <button id="load-more" class="load-more-btn" style="display: none;">
                    <i class="fas fa-redo"></i> Ongera uzane ibindi
                </button>
            </div>
        </section>
        
        <!-- Section catégories -->
        <section class="categories-section">
            <div class="section-header">
                <h2><i class="fas fa-layer-group"></i> Ibyiciro</h2>
            </div>
            
            <div class="categories-container">
                <div class="category-chip active" data-category="all">Byose</div>
                <div class="category-chip" data-category="action">Action</div>
                <div class="category-chip" data-category="drama">Drama</div>
                <div class="category-chip" data-category="comedy">Komedi</div>
                <div class="category-chip" data-category="horror">Ibitangaza</div>
                <div class="category-chip" data-category="romance">Urukundo</div>
                <div class="category-chip" data-category="adventure">Ibigeragezo</div>
                <div class="category-chip" data-category="sci-fi">Siyeñsi</div>
            </div>
        </section>
        
        <!-- Statistiques en direct -->
        <section class="stats-section">
            <div class="stats-container">
                <div class="stat-item">
                    <i class="fas fa-film"></i>
                    <div class="stat-info">
                        <span class="stat-number" id="total-movies">0</span>
                        <span class="stat-label">Filimu</span>
                    </div>
                </div>
                <div class="stat-item">
                    <i class="fas fa-tv"></i>
                    <div class="stat-info">
                        <span class="stat-number" id="total-shows">0</span>
                        <span class="stat-label">Imiseke</span>
                    </div>
                </div>
                <div class="stat-item">
                    <i class="fas fa-users"></i>
                    <div class="stat-info">
                        <span class="stat-number" id="total-content">0</span>
                        <span class="stat-label">Ibyatanzwe</span>
                    </div>
                </div>
                <div class="stat-item">
                    <i class="fas fa-clock"></i>
                    <div class="stat-info">
                        <span class="stat-number" id="total-hours">0</span>
                        <span class="stat-label">Isaha</span>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Barre de navigation inférieure -->
    <nav class="bottom-nav">
        <div class="bottom-nav-container">
            <a href="home-free.html" class="nav-item active">
                <i class="fas fa-home"></i>
                <span>Intangiriro</span>
            </a>
            
            <a href="movies.html" class="nav-item">
                <i class="fas fa-film"></i>
                <span>Filimu</span>
            </a>
            
            <a href="tvshows.html" class="nav-item">
                <i class="fas fa-tv"></i>
                <span>Imiseke</span>
            </a>
            
            <div class="nav-item menu-item" id="hamburger-menu">
                <i class="fas fa-bars"></i>
                <span>Menu</span>
                <div class="dropdown-menu">
                    <div class="dropdown-section">
                        <h3><i class="fas fa-th-large"></i> Ibyiciro</h3>
                        <a href="#" class="dropdown-link" data-category="action">Action</a>
                        <a href="#" class="dropdown-link" data-category="drama">Drama</a>
                        <a href="#" class="dropdown-link" data-category="comedy">Komedi</a>
                        <a href="#" class="dropdown-link" data-category="horror">Ibitangaza</a>
                        <a href="#" class="dropdown-link" data-category="romance">Urukundo</a>
                        <a href="#" class="dropdown-link" data-category="adventure">Ibigeragezo</a>
                        <a href="#" class="dropdown-link" data-category="sci-fi">Siyeñsi</a>
                    </div>
                    
                    <div class="dropdown-section">
                        <h3><i class="fas fa-cog"></i> Igenamiterere</h3>
                        <a href="#" class="dropdown-link" id="privacy-link">
                            <i class="fas fa-user-shield"></i> Amabanga
                        </a>
                        <a href="#" class="dropdown-link" id="help-link">
                            <i class="fas fa-question-circle"></i> Ubufasha
                        </a>
                        <div class="dropdown-link language-selector">
                            <i class="fas fa-language"></i> Ururimi
                            <select id="language-select" class="lang-select">
                                <option value="rw">Kinyarwanda</option>
                                <option value="en">English</option>
                            </select>
                        </div>
                        <a href="#" class="dropdown-link" id="upgrade-link">
                            <i class="fas fa-crown"></i> Hindura ujye mu Kwishyura
                        </a>
                    </div>
                    
                    <div class="dropdown-footer">
                        <div class="plan-info">
                            <span class="plan-badge free">Ubusa</span>
                            <span class="plan-expiry">Ushobora kureka amatangazo</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Avertissement publicitaire -->
    <div class="ad-notification">
        <div class="ad-notification-content">
            <i class="fas fa-ad"></i>
            <span>Uko uri mu buryo bwa <strong>Ubusa</strong>. Amatangazo azaboneka mu gihe usoma.</span>
            <button class="ad-notification-btn" id="ad-notification-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <!-- Script Firebase et configuration -->
    <script type="module">
        // Import Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getDatabase, 
            ref, 
            get, 
            onValue,
            query,
            orderByChild,
            limitToLast
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBaSYX1axaZrfQG2GB68LpqDYfYiVZamwE",
            authDomain: "movieshow-80226.firebaseapp.com",
            projectId: "movieshow-80226",
            storageBucket: "movieshow-80226.firebasestorage.app",
            messagingSenderId: "461492912130",
            appId: "1:461492912130:web:e715d40156e57916a1a71b",
            measurementId: "G-SGQZD7TYR0"
        };

        // Initialiser Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        // Variables globales
        let allVideos = [];
        let filteredVideos = [];
        let currentCategory = 'all';
        let currentSort = 'newest';
        let videosPerPage = 12;
        let currentPage = 1;
        
        // Fonction principale de chargement
        async function loadAllContent() {
            try {
                // Charger les films
                const moviesRef = ref(database, 'movies');
                const moviesSnapshot = await get(moviesRef);
                
                // Charger les séries
                const tvShowsRef = ref(database, 'tvshows');
                const tvShowsSnapshot = await get(tvShowsRef);
                
                allVideos = [];
                
                // Ajouter les films
                if (moviesSnapshot.exists()) {
                    moviesSnapshot.forEach((childSnapshot) => {
                        allVideos.push({
                            id: childSnapshot.key,
                            type: 'movie',
                            ...childSnapshot.val()
                        });
                    });
                }
                
                // Ajouter les séries
                if (tvShowsSnapshot.exists()) {
                    tvShowsSnapshot.forEach((childSnapshot) => {
                        allVideos.push({
                            id: childSnapshot.key,
                            type: 'tvshow',
                            ...childSnapshot.val()
                        });
                    });
                }
                
                console.log(`${allVideos.length} vidéos chargées depuis Firebase`);
                
                // Mettre à jour les statistiques
                updateStats();
                
                // Afficher les films en vedette
                loadFeaturedVideos();
                
                // Afficher toutes les vidéos
                filterAndDisplayVideos();
                
                // Afficher le bouton "charger plus" si nécessaire
                if (allVideos.length > videosPerPage) {
                    document.getElementById('load-more').style.display = 'block';
                }
                
            } catch (error) {
                console.error("Erreur de chargement Firebase:", error);
                showError();
            }
        }
        
        // Charger les films en vedette
        function loadFeaturedVideos() {
            const container = document.getElementById('featured-container');
            
            // Prendre les 5 vidéos les plus récentes comme vedettes
            const featuredVideos = [...allVideos]
                .sort((a, b) => {
                    const dateA = new Date(a.date || '2000-01-01');
                    const dateB = new Date(b.date || '2000-01-01');
                    return dateB - dateA;
                })
                .slice(0, 5);
            
            if (featuredVideos.length === 0) {
                container.innerHTML = `
                    <div class="empty-featured">
                        <i class="fas fa-film"></i>
                        <p>Nta film y'icyamamare</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            featuredVideos.forEach(video => {
                const card = document.createElement('div');
                card.className = 'featured-card';
                card.dataset.id = video.id;
                card.dataset.type = video.type;
                
                // Badge selon la langue
                let badgeClass = 'new';
                let badgeText = 'NEW';
                if (video.badge === 'FRENCH') {
                    badgeClass = 'french';
                    badgeText = 'FRENCH';
                } else if (video.badge === 'ENGLISH') {
                    badgeClass = 'english';
                    badgeText = 'ENGLISH';
                } else if (video.badge === 'KINYARWANDA') {
                    badgeClass = 'kinyarwanda';
                    badgeText = 'KINYARWANDA';
                }
                
                // Icône selon le type
                const typeIcon = video.type === 'tvshow' ? 'fa-tv' : 'fa-film';
                const typeText = video.type === 'tvshow' ? 'Iseke' : 'Film';
                
                card.innerHTML = `
                    <div class="featured-badge ${badgeClass}">${badgeText}</div>
                    <div class="featured-type ${video.type}">
                        <i class="fas ${typeIcon}"></i>
                        ${typeText}
                    </div>
                    <div class="featured-image">
                        ${video.coverUrl ? 
                            `<img src="${video.coverUrl}" alt="${video.title}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDIwMCAzMDAiIGZpbGw9IiMxRTFFMUUiPjx0ZXh0IHg9IjEwMCIgeT0iMTUwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM3NTc1NzUiPk1vdmllU2hvdzwvdGV4dD48L3N2Zz4='">` :
                            `<div class="placeholder-image">
                                <i class="fas ${typeIcon}"></i>
                                <span>MovieShow</span>
                            </div>`
                        }
                    </div>
                    <div class="featured-info">
                        <h3>${video.title || 'Filimu idasanzwe'}</h3>
                        <div class="featured-meta">
                            <span class="genre">${video.genre || 'Drama'}</span>
                            <span class="year">${video.date ? video.date.substring(0, 4) : '2024'}</span>
                            ${video.rating ? `<span class="rating"><i class="fas fa-star"></i> ${video.rating}</span>` : ''}
                        </div>
                        <p class="featured-description">
                            ${video.description ? video.description.substring(0, 80) + '...' : 'Filimu nziza yerekana ibintu byiza.'}
                        </p>
                    </div>
                `;
                
                container.appendChild(card);
            });
            
            // Initialiser le carousel
            initCarousel();
        }
        
        // Filtrer et afficher les vidéos
        function filterAndDisplayVideos() {
            let filtered = [...allVideos];
            
            // Filtrer par catégorie
            if (currentCategory !== 'all') {
                filtered = filtered.filter(video => 
                    video.genre && video.genre.toLowerCase().includes(currentCategory.toLowerCase())
                );
            }
            
            // Trier
            switch(currentSort) {
                case 'newest':
                    filtered.sort((a, b) => {
                        const dateA = new Date(a.date || '2000-01-01');
                        const dateB = new Date(b.date || '2000-01-01');
                        return dateB - dateA;
                    });
                    break;
                case 'oldest':
                    filtered.sort((a, b) => {
                        const dateA = new Date(a.date || '2000-01-01');
                        const dateB = new Date(b.date || '2000-01-01');
                        return dateA - dateB;
                    });
                    break;
                case 'title':
                    filtered.sort((a, b) => 
                        (a.title || '').localeCompare(b.title || '')
                    );
                    break;
                case 'popular':
                    filtered.sort((a, b) => 
                        (b.views || 0) - (a.views || 0)
                    );
                    break;
            }
            
            filteredVideos = filtered;
            
            // Afficher la page courante
            displayCurrentPage();
        }
        
        // Afficher la page courante
        function displayCurrentPage() {
            const grid = document.getElementById('video-grid');
            grid.innerHTML = '';
            
            const startIndex = (currentPage - 1) * videosPerPage;
            const endIndex = startIndex + videosPerPage;
            const pageVideos = filteredVideos.slice(startIndex, endIndex);
            
            if (pageVideos.length === 0) {
                grid.innerHTML = `
                    <div class="empty-grid">
                        <i class="fas fa-film-slash"></i>
                        <p>Nta film ibonetse</p>
                        <button onclick="resetFilters()" class="reset-btn">
                            <i class="fas fa-redo"></i> Subira utangire
                        </button>
                    </div>
                `;
                return;
            }
            
            pageVideos.forEach(video => {
                const card = document.createElement('div');
                card.className = 'video-card';
                card.dataset.id = video.id;
                card.dataset.type = video.type;
                card.dataset.category = video.genre ? video.genre.toLowerCase() : 'drama';
                
                // Badge selon la langue
                let badgeClass = 'new';
                let badgeText = 'NEW';
                if (video.badge === 'FRENCH') {
                    badgeClass = 'french';
                    badgeText = 'FRENCH';
                } else if (video.badge === 'ENGLISH') {
                    badgeClass = 'english';
                    badgeText = 'ENGLISH';
                } else if (video.badge === 'KINYARWANDA') {
                    badgeClass = 'kinyarwanda';
                    badgeText = 'KINYARWANDA';
                }
                
                // Icône selon le type
                const typeIcon = video.type === 'tvshow' ? 'fa-tv' : 'fa-film';
                const typeText = video.type === 'tvshow' ? 'Iseke' : 'Film';
                
                card.innerHTML = `
                    <div class="card-image">
                        <div class="card-badge ${badgeClass}">${badgeText}</div>
                        <div class="card-type">
                            <i class="fas ${typeIcon}"></i>
                            ${typeText}
                        </div>
                        ${video.coverUrl ? 
                            `<img src="${video.coverUrl}" alt="${video.title}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDMwMCAxNTAiIGZpbGw9IiMxRTFFMUUiPjx0ZXh0IHg9IjE1MCIgeT0iNzUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMiIgZmlsbD0iIzc1NzU3NSI+TW92aWVTaG93PC90ZXh0Pjwvc3ZnPg=='; this.onerror=null;">` :
                            `<div class="placeholder-thumb">
                                <i class="fas ${typeIcon}"></i>
                            </div>`
                        }
                        <div class="play-overlay">
                            <i class="fas fa-play"></i>
                        </div>
                    </div>
                    <div class="card-info">
                        <h3 class="card-title">${video.title || 'Filimu idasanzwe'}</h3>
                        <div class="card-meta">
                            <span class="card-genre">${video.genre || 'Drama'}</span>
                            <span class="card-year">${video.date ? video.date.substring(0, 4) : '2024'}</span>
                            ${video.duration ? 
                                `<span class="card-duration"><i class="fas fa-clock"></i> ${Math.floor(video.duration/60)}h${video.duration%60}m</span>` :
                                ''
                            }
                        </div>
                        ${video.description ? 
                            `<p class="card-description">${video.description.substring(0, 60)}...</p>` :
                            ''
                        }
                    </div>
                `;
                
                grid.appendChild(card);
            });
            
            // Mettre à jour le bouton "charger plus"
            updateLoadMoreButton();
        }
        
        // Mettre à jour les statistiques
        function updateStats() {
            const moviesCount = allVideos.filter(v => v.type === 'movie').length;
            const showsCount = allVideos.filter(v => v.type === 'tvshow').length;
            const totalContent = allVideos.length;
            
            // Calculer les heures totales (estimation)
            let totalHours = 0;
            allVideos.forEach(video => {
                if (video.duration) {
                    totalHours += Math.ceil(video.duration / 60);
                } else if (video.type === 'movie') {
                    totalHours += 2; // Estimation pour les films
                } else if (video.type === 'tvshow') {
                    totalHours += 10; // Estimation pour les séries
                }
            });
            
            document.getElementById('total-movies').textContent = moviesCount;
            document.getElementById('total-shows').textContent = showsCount;
            document.getElementById('total-content').textContent = totalContent;
            document.getElementById('total-hours').textContent = totalHours;
        }
        
        // Initialiser le carousel
        function initCarousel() {
            const container = document.getElementById('featured-container');
            const prevBtn = document.getElementById('prev-featured');
            const nextBtn = document.getElementById('next-featured');
            
            let scrollPosition = 0;
            const cardWidth = 320; // Largeur approximative d'une carte
            
            nextBtn.addEventListener('click', () => {
                scrollPosition += cardWidth;
                if (scrollPosition > container.scrollWidth - container.clientWidth) {
                    scrollPosition = container.scrollWidth - container.clientWidth;
                }
                container.scrollTo({
                    left: scrollPosition,
                    behavior: 'smooth'
                });
            });
            
            prevBtn.addEventListener('click', () => {
                scrollPosition -= cardWidth;
                if (scrollPosition < 0) scrollPosition = 0;
                container.scrollTo({
                    left: scrollPosition,
                    behavior: 'smooth'
                });
            });
        }
        
        // Mettre à jour le bouton "charger plus"
        function updateLoadMoreButton() {
            const loadMoreBtn = document.getElementById('load-more');
            const totalPages = Math.ceil(filteredVideos.length / videosPerPage);
            
            if (currentPage < totalPages) {
                loadMoreBtn.style.display = 'block';
                loadMoreBtn.innerHTML = `<i class="fas fa-redo"></i> Ongera uzane ibindi (${currentPage}/${totalPages})`;
            } else {
                loadMoreBtn.style.display = 'none';
            }
        }
        
        // Réinitialiser les filtres
        function resetFilters() {
            currentCategory = 'all';
            currentPage = 1;
            
            // Réinitialiser les boutons de catégorie
            document.querySelectorAll('.category-chip').forEach(chip => {
                chip.classList.remove('active');
                if (chip.dataset.category === 'all') {
                    chip.classList.add('active');
                }
            });
            
            filterAndDisplayVideos();
        }
        
        // Afficher une erreur
        function showError() {
            document.getElementById('video-grid').innerHTML = `
                <div class="error-state">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Ikosa ry'ubuhererekane</h3>
                    <p>Ntabwo byashoboye kuzana film. Ongera ugerageze.</p>
                    <button onclick="location.reload()" class="retry-btn">
                        <i class="fas fa-redo"></i> Ongera ugerageze
                    </button>
                </div>
            `;
        }
        
        // Initialiser l'application
        document.addEventListener('DOMContentLoaded', function() {
            // Vérifier si l'utilisateur a choisi un plan
            const userPlan = localStorage.getItem('movieshow_plan');
            if (!userPlan) {
                window.location.href = 'index.html';
                return;
            }
            
            // Charger la langue sauvegardée
            const savedLang = localStorage.getItem('movieshow_lang') || 'rw';
            document.getElementById('language-select').value = savedLang;
            updateLanguage(savedLang);
            
            // Initialiser les événements
            initEvents();
            
            // Charger tout le contenu
            loadAllContent();
        });
        
        // Fonction pour initialiser les événements
        function initEvents() {
            // Catégories
            document.querySelectorAll('.category-chip').forEach(chip => {
                chip.addEventListener('click', function() {
                    document.querySelectorAll('.category-chip').forEach(c => {
                        c.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    currentCategory = this.dataset.category;
                    currentPage = 1;
                    filterAndDisplayVideos();
                });
            });
            
            // Tri
            document.getElementById('sort-by').addEventListener('change', function() {
                currentSort = this.value;
                filterAndDisplayVideos();
            });
            
            // Charger plus
            document.getElementById('load-more').addEventListener('click', function() {
                const userPlan = localStorage.getItem('movieshow_plan');
                if (userPlan === 'free') {
                    window.open('https://www.effectivegatecpm.com/wu0xndpxcg?key=962747162b526b8e35632b7e46f1e881', '_blank');
                }
                
                currentPage++;
                displayCurrentPage();
            });
            
            // Gestion du menu hamburger
            document.getElementById('hamburger-menu').addEventListener('click', function(e) {
                e.stopPropagation();
                const dropdown = this.querySelector('.dropdown-menu');
                dropdown.classList.toggle('show');
            });

            document.addEventListener('click', function() {
                document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                    menu.classList.remove('show');
                });
            });
            
            // Changement de langue
            document.getElementById('language-select').addEventListener('change', function() {
                const lang = this.value;
                localStorage.setItem('movieshow_lang', lang);
                updateLanguage(lang);
            });
            
            // Mise à niveau vers premium
            document.getElementById('upgrade-link').addEventListener('click', function(e) {
                e.preventDefault();
                localStorage.setItem('movieshow_plan', 'premium');
                alert('Ujyanye no kwishyura uzakorwa vuba. Kuva none, ujye mu buryo bwa bidasabwe.');
                window.location.reload();
            });
            
            // Fermer la notification d'ads
            document.getElementById('ad-notification-btn').addEventListener('click', function() {
                document.querySelector('.ad-notification').style.display = 'none';
            });
            
            // Ouvrir les ads au clic sur une vidéo
            document.addEventListener('click', function(e) {
                if (e.target.closest('.video-card') || e.target.closest('.featured-card')) {
                    const userPlan = localStorage.getItem('movieshow_plan');
                    const card = e.target.closest('.video-card') || e.target.closest('.featured-card');
                    
                    if (userPlan === 'free') {
                        window.open('https://www.effectivegatecpm.com/wu0xndpxcg?key=962747162b526b8e35632b7e46f1e881', '_blank');
                        setTimeout(() => {
                            const videoId = card.dataset.id;
                            const videoType = card.dataset.type;
                            window.location.href = `watch.html?id=${videoId}&type=${videoType}`;
                        }, 500);
                    } else {
                        const videoId = card.dataset.id;
                        const videoType = card.dataset.type;
                        window.location.href = `watch.html?id=${videoId}&type=${videoType}`;
                    }
                }
            });
            
            // Filtrer par catégorie depuis le menu
            document.querySelectorAll('.dropdown-link[data-category]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const category = this.dataset.category;
                    
                    document.querySelectorAll('.category-chip').forEach(chip => {
                        chip.classList.remove('active');
                        if (chip.dataset.category === category) {
                            chip.classList.add('active');
                        }
                    });
                    
                    currentCategory = category;
                    currentPage = 1;
                    filterAndDisplayVideos();
                    
                    document.querySelector('.dropdown-menu').classList.remove('show');
                });
            });
        }
        
        // Fonction de traduction
        function updateLanguage(lang) {
            // Implémentation similaire aux pages précédentes
            // (Je peux la compléter si nécessaire)
        }
        
        // Exposer les fonctions globales
        window.resetFilters = resetFilters;
        window.updateLanguage = updateLanguage;
    </script>
</body>
</html>